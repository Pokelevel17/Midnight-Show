<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Midnight Swim</title>
<style>
  html,body {
    margin:0;
    height:100%;
    background:#000;
    overflow:hidden;
    font-family:"Helvetica Neue",Arial,sans-serif;
    color:#fff;
  }
  #video-container {
    position:fixed;
    inset:0;
    background:#000;
    z-index:1;
  }
  iframe {
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    border:0;
  }
  .bumper {
    position:absolute;
    inset:0;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background:#000;
    color:#fff;
    text-align:center;
    opacity:0;
    transition: opacity 0.5s ease;
    z-index:2;
    pointer-events:none;
    text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;
  }
  .show { opacity:1; }
  .bumper h1 { font-size:40px; margin:0; text-transform:uppercase; }
  .bumper p { margin-top:8px; font-size:16px; opacity:0.85; }
  .title {
    position:absolute;
    top:16px;
    left:20px;
    z-index:3;
    text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;
  }
  .title h1 {
    font-size:28px;
    margin:0;
    text-transform:uppercase;
    letter-spacing:2px;
  }
  .now-playing {
    margin-top:4px;
    font-size:14px;
    opacity:0.85;
  }
  .next-playing {
    position:absolute;
    bottom:20px;
    left:20px;
    font-size:13px;
    opacity:0.75;
    text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;
    z-index:3;
  }
</style>
</head>
<body>
<div id="video-container"></div>

<div class="bumper" id="bumper">
  <h1 id="bumpLine">PLEASE STAND BY</h1>
  <p id="bumpSub">MIDNIGHT SWIM</p>
</div>

<div class="title">
  <h1>MIDNIGHT SWIM</h1>
  <div class="now-playing" id="nowText">Loading lineup...</div>
</div>
<div class="next-playing" id="nextText"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const bumpers = [
  {line:"PLEASE STAND BY", sub:"transmission will resume shortly"},
  {line:"INTERMISSION", sub:"take a break — we’ll be right back"},
  {line:"NO SIGNAL", sub:"please stand by"},
  {line:"THANK YOU", sub:"for staying up this late"}
];

let playlist = [];
let titles = {};
let current = 0;
let player = null;
let bumperEl = document.getElementById("bumper");

async function loadVideos() {
  try {
    const res = await fetch("Videos.json");
    const data = await res.json();
    playlist = shuffle(data.videos.map(v => v.id));
    data.videos.forEach(v => titles[v.id] = v.title || "Untitled");
    onYouTubeIframeAPIReady();
  } catch(e) {
    console.error("Error loading videos:", e);
  }
}

function shuffle(a) {
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function showBumper(seconds = 5) {
  const b = bumpers[Math.floor(Math.random()*bumpers.length)];
  document.getElementById("bumpLine").textContent = b.line;
  document.getElementById("bumpSub").textContent = b.sub;
  bumperEl.classList.add("show");
  setTimeout(()=>bumperEl.classList.remove("show"), seconds*1000);
}

function onYouTubeIframeAPIReady() {
  playNext();
}

function playNext() {
  const videoId = playlist[current];
  const nextId = playlist[(current+1)%playlist.length];
  document.getElementById("nowText").textContent = "Now Playing: " + (titles[videoId] || "Unknown");
  document.getElementById("nextText").textContent = "Next: " + (titles[nextId] || "Unknown");

  if(player) {
    if(player.checkInterval) clearInterval(player.checkInterval);
    player.destroy();
  }

  player = new YT.Player('video-container', {
    videoId: videoId,
    playerVars: {
      autoplay:1,
      controls:0,
      rel:0,
      modestbranding:1,
      iv_load_policy:3,
      playsinline:1,
      fs:0,
      vq:'hd1080'
    },
    events: {
      onReady:onPlayerReady,
      onStateChange:onPlayerStateChange
    }
  });
}

function onPlayerReady(event) {
  player.playVideo();
  showBumper(5); // first 5 seconds

  // last 5 seconds
  player.checkInterval = setInterval(() => {
    const duration = player.getDuration();
    const currentTime = player.getCurrentTime();
    if(duration - currentTime <= 5){
      showBumper(5);
    }
  }, 500);
}

function onPlayerStateChange(event) {
  if(event.data === YT.PlayerState.ENDED){
    if(player.checkInterval) clearInterval(player.checkInterval);
    current = (current+1)%playlist.length;
    playNext();
  }
}

loadVideos();
</script>
</body>
</html>
