<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Midnight Channel — Broadcast Stream</title>
<style>
  :root {
    --bg:#000; --fg:#fff;
    --fade:800ms; --bump-time:6000ms;
    font-family:"Helvetica Neue",Arial,sans-serif;
  }
  html,body {margin:0;height:100%;background:var(--bg);color:var(--fg);overflow:hidden;}
  .tv {position:relative;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#000;}
  #player {position:absolute;inset:0;width:100%;height:100%;border:0;pointer-events:none;}
  .overlay {position:absolute;inset:0;background:#000;display:flex;align-items:center;justify-content:center;z-index:20;opacity:0;transition:opacity var(--fade) ease;}
  .overlay.show {opacity:1;}
  .click-block {position:absolute;inset:0;z-index:30;pointer-events:auto;background:transparent;}
  .ui {position:absolute;top:20px;left:20px;z-index:40;font-size:14px;opacity:0.9;display:flex;gap:10px;}
  .logo {font-weight:700;font-size:18px;text-transform:uppercase;}
  .schedule {position:absolute;left:20px;bottom:20px;z-index:40;font-size:13px;opacity:0.75;}
  .fs-btn {position:absolute;right:20px;bottom:20px;z-index:40;background:#111;color:#fff;border:1px solid rgba(255,255,255,0.1);border-radius:6px;padding:6px 10px;cursor:pointer;}
  .outlined {
      text-shadow:
        -1px -1px 0 #000,
         1px -1px 0 #000,
        -1px 1px 0 #000,
         1px 1px 0 #000,
        0 0 4px #000;
  }
  .bumper-text {font-family:"Courier New",monospace;text-align:center;}
  .bumper-text h1 {font-size:40px;margin:0;text-transform:uppercase;color:var(--fg);}
  .bumper-text p {margin:8px 0 0 0;font-size:14px;opacity:0.9;color:var(--fg);}
  .tv::after {content:"";position:absolute;inset:0;background:linear-gradient(rgba(255,255,255,0.03)1px,transparent 1px);background-size:100% 3px;mix-blend-mode:overlay;opacity:0.05;pointer-events:none;}
</style>
</head>
<body>
<div class="tv" id="tv">
  <div id="player"></div>
  <div class="overlay" id="overlay">
    <div class="bumper-text outlined">
      <h1 id="bumpLine">Please Stand By</h1>
      <p id="bumpSub">Midnight Channel</p>
    </div>
  </div>
  <div class="click-block" id="clickBlock"></div>
  <div class="ui outlined">
    <div class="logo">MIDNIGHT</div>
    <div id="nowText">Loading...</div>
  </div>
  <div class="schedule outlined" id="schedule">Next: —</div>
  <button class="fs-btn outlined" id="fsBtn">⛶</button>
</div>

<script>
const bumpers = [
  {line:"PLEASE STAND BY", sub:"midnight channel will return soon"},
  {line:"INTERMISSION", sub:"grab a drink — back in a moment"},
  {line:"NO SIGNAL", sub:"transmission unstable"},
  {line:"THANK YOU", sub:"for staying up this late"}
];

let playlist=[],titles={},current=0,player=null,bumperTimer=null;

// Shuffle array (Fisher–Yates)
function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

async function loadVideos() {
  const res = await fetch("Videos.json");
  const data = await res.json();
  playlist = shuffle(data.videos.map(v => v.id));
  data.videos.forEach(v => titles[v.id] = v.title || "Untitled");
}

// Load YouTube API
(function loadYT(){
  const s=document.createElement("script");
  s.src="https://www.youtube.com/iframe_api";
  document.head.appendChild(s);
})();

function onYouTubeIframeAPIReady(){
  loadVideos().then(()=>{
    if(!playlist.length){alert("No videos found in Videos.json");return;}
    player = new YT.Player("player",{
      videoId:playlist[current],
      playerVars:{
        autoplay:1,controls:0,fs:0,rel:0,modestbranding:1,
        iv_load_policy:3,disablekb:1,showinfo:0,playsinline:1,
        origin:window.location.origin
      },
      events:{
        onReady:onReady,
        onStateChange:onStateChange,
        onError:()=>showBumper(2000)
      }
    });
  });
}

function onReady(){
  try{player.playVideo();player.unMute();player.setVolume(100);}catch(e){}
  updateUI();
}

function onStateChange(e){
  if(e.data===YT.PlayerState.ENDED) showBumper();
  if(e.data===YT.PlayerState.PLAYING) hideOverlay();
}

function updateUI(){
  const cur=playlist[current];
  const next=playlist[(current+1)%playlist.length];
  document.getElementById("nowText").textContent="Now: "+(titles[cur]||"Unknown");
  document.getElementById("schedule").textContent="Next: "+(titles[next]||"Unknown");
}

function showBumper(delay=0){
  clearTimeout(bumperTimer);
  const b=bumpers[Math.floor(Math.random()*bumpers.length)];
  document.getElementById("bumpLine").textContent=b.line;
  document.getElementById("bumpSub").textContent=b.sub;
  const overlay=document.getElementById("overlay");
  overlay.classList.add("show");
  bumperTimer=setTimeout(()=>{
    nextVideo();
  },delay+6000);
}

function hideOverlay(){
  document.getElementById("overlay").classList.remove("show");
}

function nextVideo(){
  current=(current+1)%playlist.length;
  const id=playlist[current];
  updateUI();
  player.loadVideoById(id);
  try{player.playVideo();player.unMute();player.setVolume(100);}catch(e){}
  hideOverlay();
}

// Fullscreen
document.getElementById("fsBtn").onclick=()=>{
  const tv=document.getElementById("tv");
  if(!document.fullscreenElement) tv.requestFullscreen();
  else document.exitFullscreen();
};

// Prevent clicks on player
document.getElementById("clickBlock").oncontextmenu=e=>e.preventDefault();
</script>
</body>
</html>
