<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Midnight Swim</title>
<style>
:root {
  --bg:#000;
  --fg:#fff;
  font-family:"Helvetica Neue",Arial,sans-serif;
}
html,body {
  margin:0;
  height:100%;
  background:var(--bg);
  color:var(--fg);
  overflow:hidden;
}
#player {
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
}
.overlay, .static {
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
  opacity:0;
  transition:opacity 1s ease;
  z-index:10;
}
.overlay.show {opacity:1;}
.static {
  background:url('https://upload.wikimedia.org/wikipedia/commons/d/d1/Static.gif') center/cover no-repeat;
  z-index:15;
  opacity:0;
  transition:opacity 1s ease;
}
.static.show {opacity:1;}
.outlined {
  text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;
}
.bumper-text {
  text-align:center;
}
.bumper-text h1 {
  font-size:40px;
  margin:0;
  text-transform:uppercase;
}
.bumper-text p {
  margin:8px 0 0;
  font-size:14px;
  opacity:0.85;
}
.title {
  position:absolute;
  top:16px;
  left:20px;
  z-index:20;
}
.title h1 {
  font-size:28px;
  margin:0;
  text-transform:uppercase;
  letter-spacing:2px;
}
.now-playing {
  margin-top:4px;
  font-size:14px;
  opacity:0.85;
}
</style>
</head>
<body>

<div id="player"></div>

<div class="static" id="static"></div>

<div class="overlay" id="overlay">
  <div class="bumper-text outlined">
    <h1 id="bumpLine">PLEASE STAND BY</h1>
    <p id="bumpSub">MIDNIGHT SWIM</p>
  </div>
</div>

<div class="title outlined">
  <h1>MIDNIGHT SWIM</h1>
  <div class="now-playing" id="nowText">Loading lineup...</div>
</div>

<script>
// --- CONFIG ---
const bumpers = [
  { line: "PLEASE STAND BY", sub: "Transmission will resume shortly" },
  { line: "INTERMISSION", sub: "Take a break — we’ll be right back" },
  { line: "NO SIGNAL", sub: "Please stand by" },
  { line: "THANK YOU", sub: "For staying up this late" }
];

let playlist = [], titles = {}, current = 0, player = null;

// --- LOAD YT API ---
(function(){
  const tag=document.createElement("script");
  tag.src="https://www.youtube.com/iframe_api";
  document.head.appendChild(tag);
})();

// --- LOAD VIDEOS ---
async function loadVideos() {
  const res = await fetch("Videos.json");
  const data = await res.json();
  playlist = shuffle(data.videos.map(v => v.id));
  data.videos.forEach(v => titles[v.id] = v.title || "Untitled");
}

function shuffle(array) {
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

// --- YOUTUBE SETUP ---
function onYouTubeIframeAPIReady() {
  loadVideos().then(() => {
    if (!playlist.length) {
      alert("No videos found in Videos.json");
      return;
    }
    player = new YT.Player("player", {
      videoId: playlist[current],
      playerVars: {
        autoplay: 1,
        controls: 0,
        rel: 0,
        modestbranding: 1,
        iv_load_policy: 3,
        disablekb: 1,
        fs: 0,
        showinfo: 0,
        playsinline: 1
      },
      events: {
        onReady: onReady,
        onStateChange: onStateChange,
        onError: () => showBumper(2000)
      }
    });
  });
}

function onReady() {
  try {
    player.playVideo();
    player.unMute();
    player.setVolume(100);
  } catch(e){}
  showStatic(5000);
  updateUI();
}

function onStateChange(e) {
  if (e.data === YT.PlayerState.ENDED) showEndStatic();
  if (e.data === YT.PlayerState.PLAYING) hideOverlay();
}

function updateUI() {
  const cur = playlist[current];
  document.getElementById("nowText").textContent = "Now Playing: " + (titles[cur] || "Unknown");
}

function showBumper(delay = 0) {
  const b = bumpers[Math.floor(Math.random() * bumpers.length)];
  document.getElementById("bumpLine").textContent = b.line;
  document.getElementById("bumpSub").textContent = b.sub;
  const overlay = document.getElementById("overlay");
  overlay.classList.add("show");
  setTimeout(() => {
    current = (current + 1) % playlist.length;
    updateUI();
    player.loadVideoById(playlist[current]);
    try {
      player.playVideo();
      player.unMute();
      player.setVolume(100);
    } catch(e){}
    overlay.classList.remove("show");
    showStatic(5000);
  }, delay + 5000);
}

function hideOverlay() {
  document.getElementById("overlay").classList.remove("show");
}

function showStatic(duration) {
  const s = document.getElementById("static");
  s.classList.add("show");
  setTimeout(() => s.classList.remove("show"), duration);
}

function showEndStatic() {
  showStatic(5000);
  setTimeout(() => showBumper(1000), 5000);
}
</script>
</body>
</html>
